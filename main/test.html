<html><head>
<title>CONFIG_LC_MDNS_INSTANCE Control Panel</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width" />
</head>
<body bgcolor="0x111111" style="color: #BBBBEE;">
<h1>CONFIG_LC_MDNS_INSTANCE Control Panel</h1>
<h2 id="current_time">Current Local Time: ...</h2>
<h2>Actions</h2>
<p>Alarm:
<button id="alarm_snooze">Snooze</button>
<button id="alarm_stop">Stop</button></p>
<p>Sleep Timer: <button id="sleep_start">Start</button> <button id="sleep_stop">Stop</button></p>
<h2>Alarm Clock Settings</h2>
<p>Time: <select id="alarm_hour"></select>:<select id="alarm_minute"></select></p>
<p>Enabled: <select id="alarm_enabled"></select></p>
<p>LED Pattern: <select id="alarm_led_pattern"></select> <button id="run_pattern">Demo Pattern</button></p>
<p>Snooze Interval (min): <select id="alarm_snooze_interval_min"></select></p>
<h2>Sleep Timer Settings</h2>
<p>Delay: <select id="sleep_delay_min"></select> minutes from trigger to fade start</p>
<p>Fade Time: <select id="sleep_fade_time_min"></select> minutes from fade start to full-off</p>
<p>Start Color R: <select id="sleep_fade_start_r"></select> G: <select id="sleep_fade_start_g"></select> B: <select id="sleep_fade_start_b"></select></p>
<p>Fill Time: <select id="sleep_fade_fill_time_ms"></select> fade step transition duration (ms)</p>
<h2>Color Pattern Parameters</h2>
<p>Fill Time: <select id="fill_time_ms"></select> duration of fill patterns (ms)</p>
<h2>Save Settings</h2>
<p><button id="save">Save</button></p>
<!-- positioned at end so DOM elements are already loaded -->
<script>
(async function() {
'use strict';
// TEST SCAFFOLDING
//var settings_response = await fetch('/settings');
//var settings = await settings_response.json();
var settings = JSON.parse("{\"ranges\":{\"alarm_hour\":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],\"alarm_minute\":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59],\"alarm_enabled\":[0,1],\"alarm_snooze_interval_min\":[1,3,5,7,9,11,13,15],\"sleep_delay_min\":[0,1,5,10,15,30,45,60,120,180,240,300,360,420,480,540,600],\"sleep_fade_time_min\":[1,3,5,8,10,15,30,45],\"sleep_fade_start_r\":[0,40,75,100,120,150],\"sleep_fade_start_g\":[0,40,75,100,120,150],\"sleep_fade_start_b\":[0,40,75,100,120,150],\"sleep_fade_fill_time_ms\":[1000,3000,5000,7000,9000,11000],\"fill_time_ms\":[1000,3000,5000,7000,9000,11000],\"alarm_led_pattern\":[\"lpat_sudden_red\",\"lpat_sudden_green\",\"lpat_sudden_blue\",\"lpat_sudden_cyan\",\"lpat_sudden_magenta\",\"lpat_sudden_yellow\",\"lpat_sudden_black\",\"lpat_sudden_white\",\"lpat_fill_red\",\"lpat_fill_green\",\"lpat_fill_blue\",\"lpat_fill_cyan\",\"lpat_fill_magenta\",\"lpat_fill_yellow\",\"lpat_fill_black\",\"lpat_fill_white\",\"lpat_fill_whyamionfirewhite\",\"lpat_fill_auiiieeyellow\",\"lpat_fill_whosebloodisthisred\",\"lpat_current_time\",\"lpat_color_showcase\",\"lpat_brightness_gradient\",\"lpat_status_indicators\",\"lpat_local_time_in_unix_epoch_seconds\",\"lpat_fade_start\",\"lpat_fade_step\"]},\"alarm_hour\":8,\"alarm_minute\":0,\"alarm_enabled\":1,\"alarm_led_pattern\":16,\"alarm_snooze_interval_min\":9,\"sleep_delay_min\":30,\"sleep_fade_time_min\":15,\"sleep_fade_start_r\":150,\"sleep_fade_start_g\":100,\"sleep_fade_start_b\":75,\"sleep_fade_fill_time_ms\":9000,\"fill_time_ms\":11000}");
var ranges = settings.ranges;
delete settings.ranges;
Object.keys(settings).forEach(function(setting_name) {
    // Find the tag
    var elem = document.getElementById(setting_name);
    if (elem === null) { console.error('element not found for setting '+setting_name); return; }
    // Populate the tag with possible values
    var range = ranges[setting_name]
    range.forEach(function(val){
        var option_elem = document.createElement('option');
        option_elem.setAttribute('value', ''+val);
        option_elem.innerText = ''+val;
        elem.appendChild(option_elem);
    });
    // Set the value
    elem.selectedIndex = range.indexOf(settings[setting_name]);
    // Special-case the string-based field alarm_led_pattern
    if (setting_name === 'alarm_led_pattern') { elem.selectedIndex = settings[setting_name]; }
});
// Begin action handler logic
document.getElementById('save').onclick = async function post_settings() {
    var new_settings = {};
    Object.keys(settings).forEach(function(setting_name) {
        var elem = document.getElementById(setting_name);
        if (elem === null) { console.error('element not found for setting '+setting_name); return; }
        var val_array = ranges[setting_name];
        new_settings[setting_name] = ranges[setting_name][elem.selectedIndex];
        // Special-case the string-based field alarm_led_pattern
        if (setting_name === 'alarm_led_pattern') { new_settings[setting_name] = elem.selectedIndex; }
    });
    // TEST SCAFFOLDING
    console.log(JSON.stringify(new_settings));
    //await fetch('/settings', {
    //    method: 'POST',
    //    body: JSON.stringify(new_settings),
    //    headers: { 'Content-Type': 'application/json' },
    //});
}
// TEST SCAFFOLDING
var t = 0;
setInterval(async function() {
    //var time_req = await fetch('/time');
    //var time_string = await time_req.text();
    var time_string = ''+t++;
    document.getElementById('current_time').innerText = 'Current Local Time: '+time_string;
}, 1000);
document.getElementById('alarm_snooze').onclick = async function alarm_snooze() {
    await fetch('/command?alarm_snooze=1');
};
document.getElementById('alarm_stop').onclick = async function alarm_stop() {
    await fetch('/command?alarm_stop=1');
};
document.getElementById('sleep_start').onclick = async function sleep_start() {
    await fetch('/command?sleep_start=1');
};
document.getElementById('sleep_stop').onclick = async function sleep_stop() {
    await fetch('/command?sleep_stop=1');
};
document.getElementById('run_pattern').onclick = async function run_pattern() {
    await fetch('/command?run_pattern='+(document.getElementById('alarm_led_pattern').selectedIndex));
};
}());
// ESP32 light clock project
// Author: Jon Kunkee (jonathan.kunkee@gmail.com)
// Sure, it's 0BSD-licensed, but if you leave this in then I shall be most amused.
</script>
</body></html>
