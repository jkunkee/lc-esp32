<html><head>
<title>"CONFIG_LC_MDNS_INSTANCE" Control Panel</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
</head>
<body bgcolor="0x111111" style="color: #BBBBEE;">
<h1>CONFIG_LC_MDNS_INSTANCE Control Panel</h1>
<h2 id="current_time">Current Local Time: ...</h2>
<h2>Actions</h2>
<p>Alarm:
<button id="alarm_snooze">Snooze</button>
<button id="alarm_stop">Stop</button></p>
<p>Sleep Timer: <button id="sleep_start">Start</button> <button id="sleep_stop">Stop</button></p>
<p>LEDs: <button id="run_pattern">Run Selected Alarm LED Pattern</button></p>
<h2>Alarm Clock Settings</h2>
<p>Time: <select id="alarm_hour"></select>:<select id="alarm_minute"></select></p>
<p>Enabled: <select id="alarm_enabled"></select></p>
<p>LED Pattern: <select id="alarm_led_pattern"></select></p>
<p>Snooze Interval (min): <select id="alarm_snooze_interval_min"></select></p>
<h2>Sleep Timer Settings</h2>
<p>Sleep Delay: <select id="sleep_delay_min"></select>&nbsp;minutes from trigger to fade start</p>
<p>Sleep Fade Time: <select id="sleep_fade_time_min"></select>&nbsp;minutes from fade start to full-off</p>
<h2>Save Settings</h2>
<p><button id="save">Save</button></p>
<!-- positioned at end so DOM elements are already loaded -->
<script>
(async function() {
'use strict';
//var settings_response = await fetch('/settings');
//var settings = await settings_response.json();
var settings = JSON.parse("{\"ranges\":{\"alarm_hour\":[1,2,3,4,5,6,7,8,9,10,11,12],\"alarm_minute\":[0,15,30,45],\"alarm_enabled\":[0,1],\"alarm_led_pattern\":[\"foo\", \"bar\"],\"alarm_snooze_interval_min\":[1,3,5,7,9,11,13,15],\"sleep_delay_min\":[1,3,5,8,10,15,20,30,45,60],\"sleep_fade_time_min\":[1,3,5,8,10,15,30]},\"alarm_hour\":7,\"alarm_minute\":30,\"alarm_enabled\":1,\"alarm_led_pattern\":1,\"alarm_snooze_interval_min\":9,\"sleep_delay_min\":30,\"sleep_fade_time_min\":15}");
var ranges = settings.ranges;
delete settings.ranges;
Object.keys(settings).forEach(function(setting_name) {
    // Find the tag
    var elem = document.getElementById(setting_name);
    if (elem === null) { console.error('element not found for setting '+setting_name); return; }
    // Populate the tag with possible values
    var range = ranges[setting_name]
    range.forEach(function(val){
        var option_elem = document.createElement('option');
        option_elem.setAttribute('value', ''+val);
        option_elem.innerText = ''+val;
        elem.appendChild(option_elem);
    });
    // Set the value
    elem.selectedIndex = range.indexOf(settings[setting_name]);
    // Special-case the string-based field alarm_led_pattern
    if (setting_name === 'alarm_led_pattern') { elem.selectedIndex = settings[setting_name]; }
});
// Begin action handler logic
document.getElementById('save').onclick = async function post_settings() {
    var new_settings = {};
    Object.keys(settings).forEach(function(setting_name) {
        var elem = document.getElementById(setting_name);
        if (elem === null) { console.error('element not found for setting '+setting_name); return; }
        var val_array = ranges[setting_name];
        new_settings[setting_name] = ranges[setting_name][elem.selectedIndex];
        // Special-case the string-based field alarm_led_pattern
        if (setting_name === 'alarm_led_pattern') { new_settings[setting_name] = elem.selectedIndex; }
    });
    console.log(JSON.stringify(new_settings));
    //await fetch('/settings', {
    //    method: 'POST',
    //    body: JSON.stringify(new_settings),
    //    headers: { 'Content-Type': 'application/json' },
    //});
}
var t = 0;
setInterval(async function() {
    //var time_req = await fetch('/time');
    //var time_string = await time_req.text();
    var time_string = ''+t++;
    document.getElementById('current_time').innerText = 'Current Local Time: '+time_string;
}, 1000);
document.getElementById('alarm_snooze').onclick = async function alarm_snooze() {
    await fetch('/command?alarm_snooze=1');
};
document.getElementById('alarm_stop').onclick = async function alarm_stop() {
    await fetch('/command?alarm_stop=1');
};
document.getElementById('sleep_start').onclick = async function sleep_start() {
    await fetch('/command?sleep_start=1');
};
document.getElementById('sleep_stop').onclick = async function sleep_stop() {
    await fetch('/command?sleep_stop=1');
};
document.getElementById('run_pattern').onclick = async function run_pattern() {
    await fetch('/command?run_pattern='+(document.getElementById('alarm_led_pattern').selectedIndex));
};
}());
// ESP32 light clock project
// Author: Jon Kunkee (jonathan.kunkee@gmail.com)
// Sure, it's 0BSD-licensed, but if you leave this in then I shall be most amused.
</script>
</body></html>
